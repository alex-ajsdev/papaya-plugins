package net.runelite.client.plugins.autowhisperer;

//2024-11-25 15:30:05 [Client] INFO  n.r.c.p.debugger.DebuggerPlugin - ==== Projectile Spawned ====
//        2024-11-25 15:30:05 [Client] DEBUG n.r.c.p.debugger.DebuggerPlugin - Projectile ID: 2444, X: 0.0, Y: 0.0, Speed: 0.0, Height: 0.0, Interacting Name: GIM Papaya. Class Name: class Model
//2024-11-25 15:30:07 [Client] DEBUG injected-client - Chat message type GAMEMESSAGE: <img=41><col=FF0000><shad><img=90>[Donator] </col><col=FF0000></col><shad><col=FF0000>Nl Mickey:</col> <col=FF0000>gim storage not working</col>
//        2024-11-25 15:30:07 [Client] INFO  n.r.c.p.debugger.DebuggerPlugin - ==== Projectile Spawned ====
//        2024-11-25 15:30:07 [Client] DEBUG n.r.c.p.debugger.DebuggerPlugin - Projectile ID: 2445, X: 0.0, Y: 0.0, Speed: 0.0, Height: 0.0, Interacting Name: GIM Papaya. Class Name: class Model
//2024-11-25 15:30:08 [Client] DEBUG injected-client - Chat message type GAMEMESSAGE: <col=0040ff><shad><img=98>[Super Donator] </col><col=0040ff></col><shad><col=0040ff>Rng 404:</col> <col=0040ff>Mr. Moneybags over here.</col>
//        2024-11-25 15:30:10 [Client] INFO  n.r.c.p.debugger.DebuggerPlugin - ==== Projectile Spawned ====
//        2024-11-25 15:30:10 [Client] DEBUG n.r.c.p.debugger.DebuggerPlugin - Projectile ID: 2445, X: 0.0, Y: 0.
//
//2024-11-25 15:33:41 [Client] INFO  n.r.c.p.debugger.DebuggerPlugin - ==== Menu Option Clicked ====
//        2024-11-25 15:33:41 [Client] INFO  n.r.c.p.debugger.DebuggerPlugin - Menu Option: Prayer
//2024-11-25 15:33:41 [Client] INFO  n.r.c.p.debugger.DebuggerPlugin - Menu Target:
//        2024-11-25 15:33:41 [Client] INFO  n.r.c.p.debugger.DebuggerPlugin - Id: 1 ItemId: -1
//        2024-11-25 15:33:41 [Client] INFO  n.r.c.p.debugger.DebuggerPlugin - Menu Action: CC_OP
//2024-11-25 15:33:41 [Client] INFO  n.r.c.p.debugger.DebuggerPlugin - Param 0: -1
//        2024-11-25 15:33:41 [Client] INFO  n.r.c.p.debugger.DebuggerPlugin - Param 1: 10551359
//        2024-11-25 15:33:41 [Client] INFO  n.r.c.p.debugger.DebuggerPlugin - ========================
//        2024-11-25 15:33:42 [Client] INFO  n.r.c.p.debugger.DebuggerPlugin - ==== Menu Option Clicked ====
//        2024-11-25 15:33:42 [Client] INFO  n.r.c.p.debugger.DebuggerPlugin - Menu Option: Magic
//2024-11-25 15:33:42 [Client] INFO  n.r.c.p.debugger.DebuggerPlugin - Menu Target:
//        2024-11-25 15:33:42 [Client] INFO  n.r.c.p.debugger.DebuggerPlugin - Id: 1 ItemId: -1
//        2024-11-25 15:33:42 [Client] INFO  n.r.c.p.debugger.DebuggerPlugin - Menu Action: CC_OP
//2024-11-25 15:33:42 [Client] INFO  n.r.c.p.debugger.DebuggerPlugin - Param 0: -1
//        2024-11-25 15:33:42 [Client] INFO  n.r.c.p.debugger.DebuggerPlugin - Param 1: 10551360
//        2024-11-25 15:33:42 [Client] INFO  n.r.c.p.debugger.DebuggerPlugin - ========================
//2024-11-25 15:34:40 [Client] INFO  n.r.c.p.debugger.DebuggerPlugin - ========================
//        2024-11-25 15:34:41 [Client] INFO  n.r.c.p.debugger.DebuggerPlugin - ==== Menu Option Clicked ====
//        2024-11-25 15:34:41 [Client] INFO  n.r.c.p.debugger.DebuggerPlugin - Menu Option: Activate
//2024-11-25 15:34:41 [Client] INFO  n.r.c.p.debugger.DebuggerPlugin - Menu Target: <col=ff9040>Protect from Magic</col>
//        2024-11-25 15:34:41 [Client] INFO  n.r.c.p.debugger.DebuggerPlugin - Id: 1 ItemId: -1
//        2024-11-25 15:34:41 [Client] INFO  n.r.c.p.debugger.DebuggerPlugin - Menu Action: CC_OP
//2024-11-25 15:34:41 [Client] INFO  n.r.c.p.debugger.DebuggerPlugin - Param 0: -1
//        2024-11-25 15:34:41 [Client] INFO  n.r.c.p.debugger.DebuggerPlugin - Param 1: 35454993
//        2024-11-25 15:34:41 [Client] INFO  n.r.c.p.debugger.DebuggerPlugin - ========================
//        2024-11-25 15:34:42 [Client] INFO  n.r.c.p.debugger.DebuggerPlugin - ==== Menu Option Clicked ====
//        2024-11-25 15:34:42 [Client] INFO  n.r.c.p.debugger.DebuggerPlugin - Menu Option: Activate
//2024-11-25 15:34:42 [Client] INFO  n.r.c.p.debugger.DebuggerPlugin - Menu Target: <col=ff9040>Protect from Missiles</col>
//        2024-11-25 15:34:42 [Client] INFO  n.r.c.p.debugger.DebuggerPlugin - Id: 1 ItemId: -1
//        2024-11-25 15:34:42 [Client] INFO  n.r.c.p.debugger.DebuggerPlugin - Menu Action: CC_OP
//2024-11-25 15:34:42 [Client] INFO  n.r.c.p.debugger.DebuggerPlugin - Param 0: -1
//        2024-11-25 15:34:42 [Client] INFO  n.r.c.p.debugger.DebuggerPlugin - Param 1: 35454994
//        2024-11-25 15:34:42 [Client] INFO  n.r.c.p.debugger.DebuggerPlugin - ========================

import lombok.extern.slf4j.Slf4j;
import net.runelite.api.*;
import net.runelite.api.events.ProjectileSpawned;
import net.runelite.api.widgets.Widget;
import net.runelite.client.callback.ClientThread;
import net.runelite.client.eventbus.Subscribe;
import net.runelite.client.plugins.Plugin;
import net.runelite.client.plugins.PluginDescriptor;
import org.pf4j.Extension;

import javax.inject.Inject;
import java.util.Map;

@Extension
@PluginDescriptor(
        name = "Auto Whisperer",
        enabledByDefault = false,
        description = "Papaya - Auto Whisperer",
        tags = {"papaya"}
)
@Slf4j
public class AutoWhispererPlugin extends Plugin {

    @Inject
    private Client client;

    @Inject
    private ClientThread clientThread;

    private final Map<Integer, Prayer> PRAYER_MAP = Map.of(
            2445, Prayer.PROTECT_FROM_MAGIC,
            2444, Prayer.PROTECT_FROM_MISSILES
    );

    @Subscribe
    void onProjectileSpawned(ProjectileSpawned event) {
        Projectile projectile = event.getProjectile();
        Prayer prayer = PRAYER_MAP.get(projectile.getId());
        if (prayer != null) {
            if (!client.isPrayerActive(prayer)) {
                activatePrayer(prayer);
            } else {
                log.info("Prayer {} is already active. No action taken.", prayer.name());
            }
        }
    }

    private void activatePrayer(Prayer prayer) {
        Widget prayerWidget = client.getWidget(prayer.getWidgetInfo().getId());
        if(prayerWidget == null) {
            log.error("Could not find prayer widget");
            return;
        }
        log.info("Activating prayer id: {} name: {}", prayerWidget.getId(), prayerWidget.getName());
        client.invokeMenuAction(
                "Activate",
                prayerWidget.getName(),
                1,
                MenuAction.CC_OP.getId(),
                -1,
                prayerWidget.getId()
        );
    }
}
